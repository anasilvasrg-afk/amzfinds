---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';

// Get static paths for all accessory categories
export function getStaticPaths() {
  return [
    { params: { category: 'bags' } },
    { params: { category: 'shoes' } },
    { params: { category: 'jewelry' } },
    { params: { category: 'scarves' } },
    { params: { category: 'belts' } },
    { params: { category: 'hats' } },
    { params: { category: 'eyewear' } },
    { params: { category: 'hair' } },
    { params: { category: 'seasonal' } }
  ];
}

const { category } = Astro.params;

// Import outfit data and extract accessories
let accessories = [];
try {
  const data = await import('../../data/outfits.json');
  const outfits = data.default || [];
  
  // Extract accessories from all outfits
  outfits.forEach(outfit => {
    (outfit.items || []).forEach((item, idx) => {
      if (item.isAccessory && item.category === category) {
        accessories.push({
          id: `${outfit.id}-${idx}`,
          name: item.name,
          image: item.image,
          link: item.link,
          category: item.category
        });
      }
    });
  });
  
  // Remove duplicates by link
  const seen = new Set();
  accessories = accessories.filter(acc => {
    if (seen.has(acc.link)) return false;
    seen.add(acc.link);
    return true;
  });
} catch (e) {
  console.log('No outfit data found');
}

const title = `${category.charAt(0).toUpperCase() + category.slice(1)} - Daily Fashion Finds`;
const description = `Shop our curated collection of ${category}. Find the perfect accessories for your outfits.`;
---

<BaseLayout title={title} description={description}>
  <Header showBack={true} backUrl="/accessories" />
  
  <main class="max-w-7xl mx-auto px-4 py-6">
    <h1 class="text-2xl font-light text-center mb-8 capitalize text-stone-800 dark:text-neutral-200">
      {category}
    </h1>
    
    {accessories.length === 0 ? (
      <div class="text-center py-12">
        <p class="text-stone-500 dark:text-neutral-400">No {category} yet. Check back soon!</p>
      </div>
    ) : (
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        {accessories.map(item => (
          <a 
            href={item.link}
            target="_blank"
            rel="noopener noreferrer"
            class="group rounded-lg overflow-hidden transition-all hover:shadow-lg bg-white border border-stone-200 dark:bg-neutral-800 dark:border-neutral-700"
          >
            <div class="relative" style="aspect-ratio: 1/1;">
              <img 
                src={item.image}
                alt={item.name}
                loading="lazy"
                class="w-full h-full object-cover"
              />
            </div>
            <div class="p-3">
              <p class="text-sm font-medium line-clamp-2 text-stone-800 dark:text-neutral-200">{item.name}</p>
              <p class="text-xs text-stone-500 dark:text-neutral-400 mt-1">Shop on Amazon â†’</p>
            </div>
          </a>
        ))}
      </div>
    )}
  </main>
</BaseLayout>
